<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validity & Precision Lab - Interactive Learning</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .scenario {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            border-left: 4px solid #3498db;
        }
        .scenario h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        .lab-section {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .lab-section h3 {
            color: #2c3e50;
            margin-top: 0;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .control-group {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e9ecef;
        }
        .control-group h4 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 15px;
        }
        .slider-container {
            margin-bottom: 15px;
        }
        .slider-container label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        .slider:hover {
            opacity: 1;
        }
        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
        }
        .slider-value {
            display: inline-block;
            margin-left: 10px;
            font-weight: bold;
            color: #3498db;
        }
        .simulation-area {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            position: relative;
        }
        .target {
            width: 100px;
            height: 100px;
            background-color: #e74c3c;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        .shots {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        .shot {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: #27ae60;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .result-card {
            background-color: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }
        .result-card h4 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 10px;
        }
        .result-value {
            font-size: 36px;
            font-weight: bold;
            color: #3498db;
            margin: 10px 0;
        }
        .result-description {
            color: #666;
            font-size: 14px;
        }
        .explanation {
            background-color: #e8f4fd;
            border: 1px solid #b8daff;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .explanation h4 {
            color: #004085;
            margin-top: 0;
        }
        .btn {
            background-color: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background-color 0.3s ease;
        }
        .btn:hover {
            background-color: #2980b9;
        }
        .btn.secondary {
            background-color: #95a5a6;
        }
        .btn.secondary:hover {
            background-color: #7f8c8d;
        }
        .btn.success {
            background-color: #27ae60;
        }
        .btn.success:hover {
            background-color: #229954;
        }
        .data-table {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid #e9ecef;
        }
        .data-table h5 {
            margin-top: 0;
            color: #2c3e50;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“ˆ Validity & Precision Lab</h1>
        <p>Explore the concepts of validity and precision through interactive simulations. Adjust parameters to see how they affect measurement quality.</p>

        <div class="scenario">
            <h3>Research Scenario: Measuring Blood Pressure</h3>
            <p>You're conducting a study on the effectiveness of a new hypertension treatment. The true effect of the treatment is to reduce systolic blood pressure by 15 mmHg. Use the controls below to explore how different types of measurement error affect your study results.</p>
        </div>

        <div class="lab-section">
            <h3>ðŸŽ¯ Target Shooting Analogy</h3>
            <p>This simulation represents measurement precision (how close repeated measurements are to each other) and validity (how close measurements are to the true value).</p>

            <div class="simulation-area">
                <div class="target" id="target">TRUE VALUE<br>(15 mmHg â†“)</div>
                <div class="shots" id="shots"></div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <h4>Systematic Error (Bias)</h4>
                    <p>How much are all measurements consistently off from the true value?</p>
                    <div class="slider-container">
                        <label>Bias Magnitude: <span class="slider-value" id="biasValue">0</span> mmHg</label>
                        <input type="range" class="slider" id="biasSlider" min="-10" max="10" step="1" value="0">
                    </div>
                    <small>Positive = overestimation, Negative = underestimation</small>
                </div>

                <div class="control-group">
                    <h4>Random Error (Imprecision)</h4>
                    <p>How much do measurements vary randomly around the true value?</p>
                    <div class="slider-container">
                        <label>Standard Deviation: <span class="slider-value" id="precisionValue">2</span> mmHg</label>
                        <input type="range" class="slider" id="precisionSlider" min="0" max="15" step="0.5" value="2">
                    </div>
                    <small>Higher values = more scattered measurements</small>
                </div>

                <div class="control-group">
                    <h4>Sample Size</h4>
                    <p>How many measurements do you take?</p>
                    <div class="slider-container">
                        <label>Number of Measurements: <span class="slider-value" id="sampleSizeValue">20</span></label>
                        <input type="range" class="slider" id="sampleSizeSlider" min="5" max="100" step="5" value="20">
                    </div>
                    <small>Larger samples reduce random error effects</small>
                </div>
            </div>

            <div style="text-align: center; margin: 20px 0;">
                <button class="btn success" onclick="runSimulation()">Run New Simulation</button>
                <button class="btn secondary" onclick="resetSimulation()">Reset to Perfect Measurement</button>
            </div>
        </div>

        <div class="results-grid">
            <div class="result-card">
                <h4>Mean Measurement</h4>
                <div class="result-value" id="meanResult">15.0</div>
                <div class="result-description">Average of all measurements</div>
            </div>

            <div class="result-card">
                <h4>Validity (Accuracy)</h4>
                <div class="result-value" id="validityResult">100%</div>
                <div class="result-description">How close to true value</div>
            </div>

            <div class="result-card">
                <h4>Precision</h4>
                <div class="result-value" id="precisionResult">95%</div>
                <div class="result-description">How consistent measurements are</div>
            </div>

            <div class="result-card">
                <h4>Confidence Interval</h4>
                <div class="result-value" id="ciResult">13-17</div>
                <div class="result-description">95% CI around mean</div>
            </div>
        </div>

        <div class="explanation" id="explanation">
            <h4>Analysis Results:</h4>
            <p id="explanationText">This simulation shows perfect validity and high precision. All measurements are clustered closely around the true value of 15 mmHg reduction. In a real study, this would represent an ideal scenario with no systematic bias and minimal random error.</p>
        </div>

        <div class="data-table">
            <h5>Sample Measurements (mmHg reduction)</h5>
            <table id="dataTable">
                <thead>
                    <tr>
                        <th>Measurement</th>
                        <th>Value</th>
                        <th>Difference from True</th>
                    </tr>
                </thead>
                <tbody id="dataBody">
                    <!-- Data will be populated here -->
                </tbody>
            </table>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button class="btn" onclick="showScenarios()">Load Pre-set Scenarios</button>
        </div>
    </div>

    <script>
        let measurements = [];
        const trueValue = 15;
        let bias = 0;
        let precision = 2;
        let sampleSize = 20;

        // Update slider values
        document.getElementById('biasSlider').addEventListener('input', function() {
            bias = parseFloat(this.value);
            document.getElementById('biasValue').textContent = bias;
            updateTargetPosition();
        });

        document.getElementById('precisionSlider').addEventListener('input', function() {
            precision = parseFloat(this.value);
            document.getElementById('precisionValue').textContent = precision;
        });

        document.getElementById('sampleSizeSlider').addEventListener('input', function() {
            sampleSize = parseInt(this.value);
            document.getElementById('sampleSizeValue').textContent = sampleSize;
        });

        function updateTargetPosition() {
            const target = document.getElementById('target');
            // Move target based on bias (simplified visualization)
            const biasOffset = bias * 3; // Scale for visualization
            target.style.transform = `translate(-50%, -50%) translate(${biasOffset}px, 0)`;
        }

        function runSimulation() {
            // Generate measurements
            measurements = [];
            for (let i = 0; i < sampleSize; i++) {
                // Add bias + random error
                const randomError = (Math.random() - 0.5) * precision * 4; // Spread measurements
                const measurement = trueValue + bias + randomError;
                measurements.push(Math.round(measurement * 10) / 10);
            }

            // Update visualization
            updateVisualization();

            // Calculate statistics
            updateResults();

            // Update data table
            updateDataTable();
        }

        function updateVisualization() {
            const shotsContainer = document.getElementById('shots');
            shotsContainer.innerHTML = '';

            const container = document.querySelector('.simulation-area');
            const containerRect = container.getBoundingClientRect();

            measurements.forEach(measurement => {
                const shot = document.createElement('div');
                shot.className = 'shot';

                // Convert measurement to position (simplified)
                const biasOffset = bias * 3;
                const randomX = (Math.random() - 0.5) * precision * 20;
                const randomY = (Math.random() - 0.5) * precision * 20;

                shot.style.left = `calc(50% + ${biasOffset + randomX}px)`;
                shot.style.top = `calc(50% + ${randomY}px)`;

                shotsContainer.appendChild(shot);
            });
        }

        function updateResults() {
            // Calculate mean
            const mean = measurements.reduce((a, b) => a + b, 0) / measurements.length;

            // Calculate validity (1 - |bias| / trueValue, as percentage)
            const validity = Math.max(0, (1 - Math.abs(mean - trueValue) / trueValue) * 100);

            // Calculate precision (1 - standard deviation / mean, as percentage)
            const variance = measurements.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / measurements.length;
            const stdDev = Math.sqrt(variance);
            const precisionPercent = Math.max(0, (1 - stdDev / Math.abs(mean)) * 100);

            // Calculate confidence interval
            const se = stdDev / Math.sqrt(sampleSize);
            const ciLower = mean - 1.96 * se;
            const ciUpper = mean + 1.96 * se;

            // Update displays
            document.getElementById('meanResult').textContent = mean.toFixed(1);
            document.getElementById('validityResult').textContent = Math.round(validity) + '%';
            document.getElementById('precisionResult').textContent = Math.round(precisionPercent) + '%';
            document.getElementById('ciResult').textContent = ciLower.toFixed(1) + '-' + ciUpper.toFixed(1);

            // Update explanation
            updateExplanation(mean, validity, precisionPercent, ciLower, ciUpper);
        }

        function updateExplanation(mean, validity, precisionPercent, ciLower, ciUpper) {
            let text = `The mean measurement is ${mean.toFixed(1)} mmHg (true value: ${trueValue} mmHg). `;

            if (validity > 90 && precisionPercent > 90) {
                text += "Excellent validity and precision! Measurements are both accurate and consistent.";
            } else if (validity > 90) {
                text += "Good validity but poor precision. Measurements are accurate on average but vary widely.";
            } else if (precisionPercent > 90) {
                text += "Good precision but poor validity. Measurements are consistent but systematically biased.";
            } else {
                text += "Poor validity and precision. Measurements are both inaccurate and inconsistent.";
            }

            text += ` The 95% confidence interval is ${ciLower.toFixed(1)}-${ciUpper.toFixed(1)} mmHg.`;

            if (ciLower <= trueValue && ciUpper >= trueValue) {
                text += " The true value falls within the confidence interval, indicating good statistical coverage.";
            } else {
                text += " The true value falls outside the confidence interval, suggesting systematic problems with the measurement method.";
            }

            document.getElementById('explanationText').textContent = text;
        }

        function updateDataTable() {
            const tbody = document.getElementById('dataBody');
            tbody.innerHTML = '';

            measurements.slice(0, 10).forEach((measurement, index) => {
                const row = document.createElement('tr');
                const diff = measurement - trueValue;

                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${measurement}</td>
                    <td>${diff >= 0 ? '+' : ''}${diff.toFixed(1)}</td>
                `;

                tbody.appendChild(row);
            });

            if (measurements.length > 10) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="3"><em>... and ${measurements.length - 10} more measurements</em></td>`;
                tbody.appendChild(row);
            }
        }

        function resetSimulation() {
            bias = 0;
            precision = 2;
            sampleSize = 20;

            document.getElementById('biasSlider').value = 0;
            document.getElementById('precisionSlider').value = 2;
            document.getElementById('sampleSizeSlider').value = 20;

            document.getElementById('biasValue').textContent = '0';
            document.getElementById('precisionValue').textContent = '2';
            document.getElementById('sampleSizeValue').textContent = '20';

            updateTargetPosition();
            runSimulation();
        }

        function showScenarios() {
            const scenarios = [
                { name: "Perfect Measurement", bias: 0, precision: 1, sampleSize: 30 },
                { name: "High Precision, Low Validity", bias: 5, precision: 1, sampleSize: 30 },
                { name: "High Validity, Low Precision", bias: 0, precision: 8, sampleSize: 30 },
                { name: "Poor Everything", bias: -3, precision: 10, sampleSize: 10 },
                { name: "Real World Scenario", bias: 2, precision: 4, sampleSize: 50 }
            ];

            const scenarioText = scenarios.map(s => `${s.name}: Bias=${s.bias}, Precision=${s.precision}, N=${s.sampleSize}`).join('\n');
            const selected = prompt("Choose a scenario:\n\n" + scenarioText + "\n\nEnter scenario name:");

            const scenario = scenarios.find(s => s.name.toLowerCase().includes(selected.toLowerCase()));
            if (scenario) {
                bias = scenario.bias;
                precision = scenario.precision;
                sampleSize = scenario.sampleSize;

                document.getElementById('biasSlider').value = bias;
                document.getElementById('precisionSlider').value = precision;
                document.getElementById('sampleSizeSlider').value = sampleSize;

                document.getElementById('biasValue').textContent = bias;
                document.getElementById('precisionValue').textContent = precision;
                document.getElementById('sampleSizeValue').textContent = sampleSize;

                updateTargetPosition();
                runSimulation();
            }
        }

        // Initialize
        runSimulation();
    </script>
</body>
</html>
